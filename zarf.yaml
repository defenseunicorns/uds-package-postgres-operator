# Copyright 2024 Defense Unicorns
# SPDX-License-Identifier: AGPL-3.0-or-later OR LicenseRef-Defense-Unicorns-Commercial

kind: ZarfPackageConfig
metadata:
  name: postgres-operator
  description: "PostgreSQL is a powerful, open source object-relational database system that uses and extends the SQL language combined with many features that safely store and scale the most complicated data workloads. PostgreSQL comes with many features aimed to help developers build applications, administrators to protect data integrity and build fault-tolerant environments, and help you manage your data no matter how big or small the dataset. In addition to being free and open source, PostgreSQL is highly extensible. For example, you can define your own data types, build out custom functions, even write code from different programming languages without recompiling your database!"
  url: https://github.com/zalando/postgres-operator
  version: "dev"
  annotations:
    dev.uds.title: Postgres Operator
    dev.uds.tagline: '**The World''s Most Advanced Open Source Relational Database**'
    dev.uds.categories: Databases, IT Management, Software Dev
    dev.uds.keywords: Open Source Database, Object-Relational Database, SQL, Data Integrity, Fault-Tolerant, Data Management, Extensibility, Custom Data Types, Custom Functions, Scalability, Free and Open Source
    dev.uds.icon: data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnY9Imh0dHBzOi8vdmVjdGEuaW8vbmFubyIgd2lkdGg9IjgwIiBoZWlnaHQ9IjgwIiBmaWxsPSJub25lIj48c3R5bGU+PCFbQ0RBVEFbLkd7c3Ryb2tlLWxpbmVjYXA6cm91bmR9Lkh7c3Ryb2tlLXdpZHRoOjEuMzF9Lkl7c3Ryb2tlLWxpbmVqb2luOnJvdW5kfV1dPjwvc3R5bGU+PGcgY2xpcC1wYXRoPSJ1cmwoI0EpIj48cGF0aCBmaWxsPSIjZmZmIiBmaWxsLW9wYWNpdHk9Ii4wMSIgc3R5bGU9Im1peC1ibGVuZC1tb2RlOm11bHRpcGx5IiBkPSJNMTIgMTJoNTZ2NTZIMTJ6Ii8+PHBhdGggZD0iTTUzLjU3NyA1Mi44ODZjLjM1Ny0yLjk5NS4yNTItMy40MzYgMi40OC0yLjk1M2wuNTY4LjA1M2MxLjcxMy4wNzQgMy45NjItLjI3MyA1LjI4Ni0uODkzIDIuODM3LTEuMzE0IDQuNTI5LTMuNTIgMS43MjMtMi45NDItNi4zODkgMS4zMTQtNi44MzEtLjg0MS02LjgzMS0uODQxIDYuNzQ2LTEwLjAwNCA5LjU2My0yMi43MDkgNy4xMzUtMjUuODE5LTYuNjQxLTguNDgtMTguMTI3LTQuNDc3LTE4LjMyNy00LjM3MmwtLjA2My4wMTFjLTEuMjYxLS4yNjMtMi42OC0uNDItNC4yNjYtLjQ0MS0yLjg5LS4wNTMtNS4wODYuNzU3LTYuNzQ2IDIuMDE4IDAgMC0yMC41MDItOC40NDktMTkuNTQ2IDEwLjYyNC4yIDQuMDU2IDUuODExIDMwLjY5NSAxMi41MDUgMjIuNjQ2IDIuNDQ4LTIuOTQyIDQuODEzLTUuNDMzIDQuODEzLTUuNDMzIDEuMTc3Ljc3OCAyLjU3NSAxLjE3NyA0LjA1NiAxLjAzbC4xMTYtLjA5NWMtLjAzMi4zNjgtLjAyMS43MjUuMDQyIDEuMTQ1LTEuNzEzIDEuOTIzLTEuMjA4IDIuMjctNC42NTUgMi45NzQtMy40ODkuNzE1LTEuNDQgMS45OTctLjEwNSAyLjMzMyAxLjYxOC40MSA1LjM3Ljk3NyA3LjkxMy0yLjU2NGwtLjEwNS40MWMuNjcyLjUzNi42MyAzLjg4OC43MjUgNi4yODRzLjI1MiA0LjYyNC43NDYgNS45MzdjLjQ4MyAxLjMxNCAxLjA2MSA0LjcwOCA1LjU5IDMuNzMxIDMuNzk0LS44MiA2LjY4My0xLjk4NiA2Ljk0Ni0xMi44NDF6IiBmaWxsPSIjMDAwIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMy45MyIvPjxwYXRoIGQ9Ik02My42MzQgNDYuMTVjLTYuMzg5IDEuMzE0LTYuODMxLS44NDEtNi44MzEtLjg0MSA2Ljc0Ni0xMC4wMDQgOS41NjMtMjIuNzE5IDcuMTM1LTI1LjgxOS02LjY0MS04LjQ4LTE4LjEyNy00LjQ2Ni0xOC4zMjctNC4zNzJsLS4wNjMuMDExYy0xLjI2MS0uMjYzLTIuNjgtLjQyLTQuMjY2LS40NDEtMi44OS0uMDUyLTUuMDg2Ljc1Ny02Ljc0NiAyLjAxOCAwIDAtMjAuNTAyLTguNDQ5LTE5LjU0NiAxMC42MjQuMiA0LjA1NiA1LjgxMSAzMC42OTUgMTIuNTA1IDIyLjY0NiAyLjQ0OC0yLjk0MiA0LjgxMy01LjQzMyA0LjgxMy01LjQzMyAxLjE3Ny43NzggMi41NzUgMS4xNzcgNC4wNTYgMS4wM2wuMTE2LS4wOTVjLS4wMzIuMzY4LS4wMjEuNzI1LjA0MiAxLjE0NS0xLjcxMyAxLjkyMy0xLjIwOCAyLjI3LTQuNjU1IDIuOTc0LTMuNDg5LjcxNS0xLjQ0IDEuOTk3LS4xMDUgMi4zMzMgMS42MTguNDEgNS4zNy45NzcgNy45MTMtMi41NjRsLS4xMDUuNDFjLjY3Mi41MzYgMS4xNDUgMy41MiAxLjA3MiA2LjIyMS0uMDg0IDIuNzAxLS4xMzcgNC41NS4zOTkgNnMxLjA2MSA0LjcwOCA1LjU5IDMuNzNjMy43ODMtLjgwOSA1Ljc0OC0yLjkxMSA2LjAyMS02LjQyMS4xODktMi40OS42My0yLjEyMy42NjItNC4zNWwuMzQ3LTEuMDUxYy40MS0zLjM4NC4wNjMtNC40NjYgMi4zOTYtMy45NjJsLjU2OC4wNTNjMS43MTMuMDczIDMuOTYyLS4yNzMgNS4yODYtLjg5MyAyLjg0OC0xLjMzNCA0LjUyOS0zLjUzMSAxLjcyMy0yLjk1M3oiIGZpbGw9IiMzMzY3OTEiLz48ZyBzdHJva2U9IiNmZmYiPjxnIGNsYXNzPSJHIEgiPjxwYXRoIGQ9Ik0zOS45NDggNDguMDg0Yy0uMTc5IDYuMjg0LjA0MiAxMi42MjEuNjYyIDE0LjE2NS42MiAxLjUzNCAxLjkzNCA0LjUyOSA2LjQ2MyAzLjU2MiAzLjc4My0uODA5IDUuMTYtMi4zODUgNS43NTktNS44NTMuNDQxLTIuNTU0IDEuMjkzLTkuNjM2IDEuMzk4LTExLjA4Nk0zNC41MTUgMTYuNTU4UzE0LjAwMiA4LjE3MyAxNC45NTkgMjcuMjQ2Yy4yIDQuMDU2IDUuODExIDMwLjY5NSAxMi41MDUgMjIuNjQ2IDIuNDQ4LTIuOTQyIDQuNjU1LTUuMjU0IDQuNjU1LTUuMjU0bTEzLjQ4Mi0yOS42MDJjLS43MTUuMjIxIDExLjQxMi00LjQzNCAxOC4yOTUgNC4zNzIgMi40MzggMy4xMTEtLjM4OSAxNS44MTUtNy4xMzUgMjUuODE5IiBjbGFzcz0iSSIvPjxwYXRoIGQ9Ik01Ni43NjEgNDUuMjI2cy40NDEgMi4xNjUgNi44MzEuODQxYzIuNzk1LS41NzggMS4xMTQgMS42MTgtMS43MjMgMi45NDItMi4zMzMgMS4wODItNy41NTYgMS4zNTYtNy42NC0uMTM3LS4yMjEtMy44NDYgMi43NTMtMi42OCAyLjUzMy0zLjY0N3ptMCAwYy0uMTg5LS44NzItMS41MjQtMS43MjMtMi4zOTYtMy44NTctLjc2Ny0xLjg2LTEwLjUxOS0xNi4xMDkgMi43MDEtMTMuOTk3LjQ4My0uMTA1LTMuNDQ3LTEyLjU3OS0xNS44MTUtMTIuNzc4UzI5LjI5MiAyOS43OTkgMjkuMjkyIDI5Ljc5OSIgc3Ryb2tlLWxpbmVqb2luPSJiZXZlbCIvPjwvZz48ZyBjbGFzcz0iSCBJIj48cGF0aCBkPSJNMzYuNDggNDYuNTQ5Yy0xLjcyMyAxLjkyMy0xLjIxOSAyLjI1OS00LjY2NiAyLjk3NC0zLjQ4OS43MTUtMS40NCAxLjk5Ny0uMTA1IDIuMzMzIDEuNjE4LjQxIDUuMzcuOTc3IDcuOTEzLTIuNTY0Ljc2Ny0xLjA4MiAwLTIuODA2LTEuMDYxLTMuMjQ3LS41MTUtLjIyMS0xLjE5OC0uNDgzLTIuMDgxLjUwNHoiLz48cGF0aCBkPSJNMzYuMzc1IDQ2LjUwN2MtLjE3OS0xLjEzNS4zNjgtMi40OC45NTYtNC4wNTYuODgzLTIuMzY0IDIuOTExLTQuNzI5IDEuMjgyLTEyLjIzMi0xLjIwOS01LjU5MS05LjMyMS0xLjE2Ni05LjMzMS0uNDEgMCAuNzU3LjM2OCAzLjg0Ni0uMTM3IDcuNDQtLjY1MSA0LjY4NyAyLjk4NCA4LjY0OCA3LjE3NyA4LjI0OSIgY2xhc3M9IkciLz48L2c+PGcgZmlsbD0iI2ZmZiI+PHBhdGggZD0iTTM0LjQ0MSAyOS43MDRjLS4wMzIuMjYzLjQ3My45NDYgMS4xMzUgMS4wNHMxLjIzLS40NTIgMS4yNzEtLjcwNGMuMDMyLS4yNjMtLjQ3My0uNTQ3LTEuMTM1LS42NDFzLTEuMjQuMDQyLTEuMjcyLjMwNXoiIHN0cm9rZS13aWR0aD0iLjQzNyIvPjxwYXRoIGQ9Ik01NC42OTEgMjkuMTY4Yy4wMzIuMjYzLS40NzMuOTQ2LTEuMTM1IDEuMDRzLTEuMjMtLjQ1Mi0xLjI3MS0uNzA0Yy0uMDMyLS4yNjMuNDczLS41NDYgMS4xNDUtLjY0MS42NTItLjA4NCAxLjIxOS4wNTMgMS4yNjEuMzA1eiIgc3Ryb2tlLXdpZHRoPSIuMjE4Ii8+PC9nPjwvZz48L2c+PC9zdmc+

components:
  # CRD lifecycle is managed outside of the main chart to support upgrades
  - name: crds
    required: true
    manifests:
      - name: crds
        files:
          - https://github.com/zalando/postgres-operator/raw/v1.14.0/charts/postgres-operator/crds/operatorconfigurations.yaml
          - https://github.com/zalando/postgres-operator/raw/v1.14.0/charts/postgres-operator/crds/postgresqls.yaml
          - https://github.com/zalando/postgres-operator/raw/v1.14.0/charts/postgres-operator/crds/postgresteams.yaml
  - name: postgres-operator
    required: true
    only:
      flavor: registry1
      cluster:
        architecture: amd64
    import:
      path: common
    charts:
      - name: postgres-operator
        valuesFiles:
          - ./values/registry1-values.yaml
      - name: uds-postgres-config
        valuesFiles:
          - ./values/registry1-config-values.yaml
    images:
      # Iron Bank
      - registry1.dso.mil/ironbank/opensource/zalando/postgres-operator:v1.14.0
      - registry1.dso.mil/ironbank/opensource/zalando/logical-backup:v1.8.2
      - registry1.dso.mil/ironbank/opensource/zalando/pgbouncer:1.21.0
      # Docker image that provides PostgreSQL and Patroni bundled together for PostgreSQL HA
      - ghcr.io/zalando/spilo-17:4.0-p2
      # Container image that provides the postgres-exporter sidecar to create a metrics endpoint
      - registry1.dso.mil/ironbank/opensource/prometheus/postgres-exporter:v0.17.1

  - name: postgres-operator
    required: true
    only:
      flavor: upstream
    import:
      path: common
    charts:
      - name: postgres-operator
        valuesFiles:
          - ./values/upstream-values.yaml
      - name: uds-postgres-config
        valuesFiles:
          - ./values/upstream-config-values.yaml
    images:
      - ghcr.io/zalando/postgres-operator:v1.14.0
      - ghcr.io/zalando/postgres-operator/logical-backup:v1.14.0
      - docker.io/bitnami/pgbouncer:1.24.0
      # Docker image that provides PostgreSQL and Patroni bundled together for PostgreSQL HA
      - ghcr.io/zalando/spilo-17:4.0-p2
      # Container image that provides the postgres-exporter sidecar to create a metrics endpoint
      - quay.io/prometheuscommunity/postgres-exporter:v0.17.1

  - name: postgres-operator
    required: true
    only:
      flavor: unicorn
    import:
      path: common
    charts:
      - name: postgres-operator
        valuesFiles:
          - ./values/unicorn-values.yaml
      - name: uds-postgres-config
        valuesFiles:
          - ./values/unicorn-config-values.yaml
    images:
      - cgr.dev/du-uds-defenseunicorns/postgres-operator-fips:1.14.0
      - ghcr.io/zalando/postgres-operator/logical-backup:v1.14.0
      - cgr.dev/du-uds-defenseunicorns/pgbouncer-fips:1.24.0
      # Docker image that provides PostgreSQL and Patroni bundled together for PostgreSQL HA
      - ghcr.io/zalando/spilo-17:4.0-p2
      # Container image that provides the postgres-exporter sidecar to create a metrics endpoint
      - cgr.dev/du-uds-defenseunicorns/prometheus-postgres-exporter-fips:0.17.1
